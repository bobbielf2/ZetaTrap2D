function c = kapur_rokhlin_sep_log(k)
% Compute Kapur-Rokhlin correction weights for the "separable" logarithmic 
% singularity of the form 
%       -\log|x| * \phi(x), x\in[-a,a]
% Use Table 7 of [1] when weights available for the given k,
% otherwise compute weights via the zeta correction approach [2].
%
% Note that the output weight is negative of the K-R weights, and the
% center weight c(1) is scaled by 2.
%
% [1] Kapur, S., & Rokhlin, V. (1997). High-order corrected trapezoidal 
%     quadrature rules for singular functions. SIAM J. on Numer. Anal., 
%     34(4), 1331-1356.
% [2] Wu, B., & Martinsson, P.G. (2020). Zeta Correction: A New Approach 
%     to Constructing Corrected Trapezoidal Rule for Singular Integral 
%     Operators. (arxiv)
%     
% Bowei Wu, May 2020; Updated Jan 2021.

if k <= 21 % extract precomputed weights
    c = precom_weights(k); 
else
    % zeta connection approach (require Symbolic Math Toolbox!)
    rhs = imag(zeta(-2*vpa(0:(k-1))'+1i*eps)/eps); % derivative of zeta ia complex step differentiation
    V = vpa(0:(k-1)).^((0:2:2*(k-1))'); % extended precision Vandermonde matrix to combat ill-conditioning for large k
    c = double(V\rhs);
end
% post-processing
c = -c'; % negative of K-R weights; row vector
c(1) = 2*c(1); % scale center weight by 2


function c = precom_weights(k)
% precomputed weights
switch k
    case 0
        c = 0;
    case 1
        c = -.9189385332046728E+00;
    case 2
        c = [-.8884900761462795E+00;
             -.3044845705839327E-01];
    case 3
        c = [-.8788820090191140E+00;
             -.4325921322794724E-01;
             0.3202689042388492E-02];
    case 4
        c = [-.8742261022238798E+00;
             -.5024307342079858E-01;
             0.5996233119529027E-02;
             -.4655906795234226E-03];
    case 5
        c = [-.8714860605482545E+00;
             -.5462714010179898E-01;
             0.8188266460029230E-02;
             -.1091885919666338E-02
             0.7828690501786438E-04];
    case 6
        c = [-.8696829990422169e+00
             -.5763224261186158e-01
             0.9905467894350714e-02
             -.1735836457536895e-02
             0.2213870245446548e-03
             -.1431001195267904e-04];
    case 7
        c = [-.8684070729221126e+00
             -.5981954453204053e-01
             0.1127253159446256e-01
             -.2343420324253269e-02
             0.4036621845595672e-03
             -.4745095013720858e-04
             0.2761744848710795e-05];
    case 8
        c = [-.8674568230266233E+00;
             -.6148248184914681E-01;
             0.1238115647253341E-01;
             -.2897732763288696E-02;
             0.6052303442088134E-03;
             -.9784299004952013E-04;
             0.1051436637368180E-04;
             -.5537586803550720E-06];
    case 9
        c = [-8.667217685202481e-01
            -6.278924541603598e-02
            1.329589096935583e-02
            -3.396678852464558e-03
            8.131245480320894e-04
            -1.618104373797589e-04
            2.422167651587582e-05
            -2.381400032647607e-06
            1.142275845182835e-07];
    case 10
        c = [-8.661362919262486e-01
            -6.384310328523506e-02
            1.406233305604607e-02
            -3.843770069700536e-03
            1.019474340602541e-03
            -2.355067918692058e-04
            4.387403771306165e-05
            -6.066217757119951e-06
            5.477355521032650e-07
            -2.408377597694342e-08];
    case 11
        c = [-8.656589775871730e-01
            -6.471094753809971e-02
            1.471321624569456e-02
            -4.244313571022683e-03
            1.219746091263614e-03
            -3.156154921336350e-04
            6.890800654569580e-05
            -1.195656336479857e-05
            1.529459820049702e-06
            -1.274231726028842e-07
            5.166969831297037e-09];
    case 12
        c = [-8.652624006844107e-01
            -6.543800519316395e-02
            1.527249136497475e-02
            -4.603847576274231e-03
            1.411497560731106e-03
            -3.995067600256630e-04
            9.851668933111743e-05
            -2.018119747186014e-05
            3.260961737325822e-06
            -3.871484601943020e-07
            2.990271150667017e-08
            -1.124351894335142e-09];
    case 13
        c = [-8.649276817257863e-01
            -6.605594788600917e-02
            1.575801776649599e-02
            -4.927531843955059e-03
            1.593569961301572e-03
            -4.851878897058821e-04
            1.318371286512027e-04
            -3.070344146767653e-05
            5.891522736279919e-06
            -8.882076980903206e-07
            9.822897121976360e-08
            -7.065765782430224e-09
            2.475589120039617e-10];
    case 14
        c = [-8.646413998951066e-01
            -6.658761414298577e-02
            1.618335077207727e-02
            -5.219948285292188e-03
            1.765579632676354e-03
            -5.711927253932730e-04
            1.680496910458936e-04
            -4.337783830581833e-05
            9.512778975749005e-06
            -1.711220479787840e-06
            2.413616289062888e-07
            -2.495734799324587e-08
            1.678885488869214e-09
            -5.505102218712507e-11];
    case 15
        c = [-.8643937537784726e+00
             -.6704988689403577e-01
             0.1655894738230539e-01
             -.5485075304276741e-02
             0.1927601699833581e-02
             -.6564674975812871e-03
             0.2064233385304999e-03
             -.5799637068090648e-04
             0.1416413018600432e-04
             -.2924616447680532e-05
             0.4941524555505997e-06
             -.6540388025633560e-07
             0.6345793057687260e-08
             -.4007478791366100e-09
             0.1234631631962446e-10];
    case 16
        c = [-.8641774186256508E+00;
             -.6745551530557688E-01;
             0.1689299430945688E-01;
             -.5726331418330602E-02;
             0.2079973982393914E-02;
             -.7402722529894703E-03;
             0.2463303649153491E-03;
             -.7432197238379932E-04;
             0.1984260034353227E-04;
             -.4580836910292848E-05;
             0.8916453665775555E-06;
             -.1418448246845963E-06;
             0.1767037741742959E-07;
             -.1614096203394717E-08;
             0.9602551109604562E-10;
             -.2789306492547372E-11];
    case 17
        c = [-8.639868107462301e-01
            -6.781430660801560e-02
            1.719198706148916e-02
            -5.946641867196491e-03
            2.223175774156742e-03
            -8.221018482825149e-04
            2.872451625618713e-04
            -9.211101483880899e-05
            2.651349126416089e-05
            -6.715522004894010e-06
            1.466368276662483e-06
            -2.695610269256914e-07
            4.047684210333943e-08
            -4.759815470416764e-09
            4.105974377982503e-10
            -2.308426950559283e-11
            6.342175941576707e-13];
    case 18
        c = [-8.638175993316175e-01
            -6.813392816895060e-02
            1.746114206017127e-02
            -6.148508116208072e-03
            2.357753273497796e-03
            -9.016249160749561e-04
            3.287354588014059e-04
            -1.111274006152623e-04
            3.412004557474223e-05
            -9.348560035479858e-06
            2.246527693132365e-06
            -4.646008810431617e-07
            8.082991536902293e-08
            -1.148532768136401e-08
            1.278405465017250e-09
            -1.044412720573741e-10
            5.564945021538352e-12
            -1.450213949229612e-13];
    case 19
        c = [-8.636663737810238e-01
            -6.842046079112800e-02
            1.770469478902206e-02
            -6.334072100094389e-03
            2.484274171602103e-03
            -9.786376366601862e-04
            3.704506824517389e-04
            -1.311507079674222e-04
            4.259144483911755e-05
            -1.248611531858182e-05
            3.255027605557997e-06
            -7.428077534364396e-07
            1.457448522607878e-07
            -2.404950901525398e-08
            3.241558798437558e-09
            -3.423992518658962e-10
            2.656123735758442e-11
            -1.344809528411308e-12
            3.332744815245409e-14];
    case 20
        c = [-.8635304116647681E+00;
             -.6867878881201404E-01;
             0.1792611880692437E-01;
             -.6505172477564357E-02;
             0.2603300521146428E-02;
             -.1053029105125390E-02;
             0.4121099047922528E-03;
             -.1519803191376791E-03;
             0.5184904980367620E-04;
             -.1612303155465844E-04;
             0.4509136652480968E-05;
             -.1119040467513331E-05;
             0.2428371655709533E-06;
             -.4528845255185268E-07;
             0.7103184896000958E-08;
             -.9102854426840433E-09;
             0.9146251630822981E-10;
             -.6753249440965090E-11;
             0.3256755515337396E-12;
             -.7693371141612778E-14];
    case 21
        c = [-.8634075135173825E+00
             -.6891288052131983E-01;
             0.1812828891950665E-01;
             -.6663392565672225E-02;
             0.2715373083556168E-02;
             -.1124755545067623E-02
             0.4534905432204645E-03
             -.1734369464708259E-03
             0.6181105535120864E-04
             -.2024524074674083E-04
             0.6020613356244510E-05
             -.1606613597759635E-05
             0.3799671084527263E-06
             -.7853207506864614E-07
             0.1394746012004667E-07
             -.2083589766806165E-08
             0.2544214502140801E-09
             -.2437043148484079E-10
             0.1716505712892348E-11
             -.7901799480102858E-13
             0.1783115591485395E-14];
end